<!DOCTYPE html>
{% load staticfiles %}
<html lang="en">
<head>
    <style>
        html { height: 100%}
        body {height:100%}
        #map{height: 100%}
    </style>
    <meta charset="UTF-8">
    <title>Team Aqua</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="http://d3js.org/d3.v3.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <!-- Load Leaflet from CDN-->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/leaflet/0.7.3/leaflet.css" />
    <script src="//cdn.jsdelivr.net/leaflet/0.7.3/leaflet.js"></script>

    <!-- Load Esri Leaflet from CDN -->
    <script src="//cdn.jsdelivr.net/leaflet.esri/1.0.0/esri-leaflet.js"></script>

    <!-- Geo Code Leaflet -->
    <script src="//cdn.jsdelivr.net/leaflet.esri.geocoder/1.0.2/esri-leaflet-geocoder.js"></script>


    <link rel="stylesheet" type="text/css" href="{% static 'api/bootstrap.min.css' %}"/>
    <script>
        $(document).ready(function(){
                    // Add event listeners
                    //Adds event listener for the Find Hydrogen Stations button.  Will call the geoCoding function to
                    //receive latitude and longitude coordinates.
                document.getElementById("findHYButton").addEventListener("click", geoCode, false);
                }
        )

        function geoCode()
        {
            var address = document.getElementById("zip").value;


            console.log(address);
            document.getElementsByClassName("geocoder-control-input leaflet-bar")[0].value = address;
            console.log(document.getElementsByClassName("geocoder-control-input leaflet-bar")[0].value);

            var e = jQuery.Event("click");
            e.which = 13; // #Enter key code value
            e.keyCode = 13;
           $(".geocoder-control-input.leaflet-bar").focus();


        };

        function showRecommendations()
        {
            var agency = $('#agency').val();
            var total_milage = $('#total_milage').val();
            var fuel_type = $('#fuel_type').val();
            if (agency == null || agency.trim() == ''){
                agency = 50;
            }
            if (total_milage == null || total_milage.trim() == ''){
                total_milage = 100000;
            }
            if (fuel_type == null || fuel_type.trim() == ''){
                fuel_type = 'GAS';
            }
            $.getJSON('{% url 'api:showRecommendations' %}', {"agency": agency,"total_milage": total_milage,"fuel_type": fuel_type}, function(data){
                //$(canvas).remove();
                console.log(data);
                $("#showRecTable tr").remove();
                $.each(data, function(i, item) {
                    $('#showRecTable').append('<tr><td>' + data[i]['agency'] + '</td><td>' + data[i]['postal_code'] +
                            '</td><td>' + data[i]['vin'] + '</td></tr>');
                })

            });

         }

        function findNearestElectricButton()
        {

        }

        function agencyNearestHydrogenStation()
        {

        }
    </script>
</head>
<body>
    <div id="contents" class="container-fluid">
        <div class="row">
            <div id="map" class="col-md-8" style="position:relative; height: 800px;">
               <!-- <div id="map"></div>-->
            </div>
            <!-- Side Bar -->
            <div class="col-md-4 well">
                <!-- Find Hydrogen -->
                <div class="row">
                    <div class="col-md-12 panel panel-default">
                        <div class="panel-heading">
                            <div class="panel-title">
                                <a data-toggle="collapse" href="#collapseFindHydrogen">
                                    Find Hydrogen Stations
                                </a>
                            </div>
                        </div>
                        <div class="panel-body">
                        <div id="collapseFindHydrogen" class="panel-collapse">
                            <div class="panel-group">
                                <label for="stations_within">
                                    Stations within
                                </label>
                                <input class="form-control" id="stations_within" type="text" value="50"/>
                            </div>
                            <div class="panel-group">
                                <label for="zip">
                                    Miles Of
                                </label>
                                <input class="form-control" id="zip" type="text" value="95835"/>
                            </div>
                            <div class="panel-footer">
                                <button onclick="findHydrogenStationsButton(); return false;" class="btn btn-default " id="findHYButton" type="submit">
                                    Search
                                </button>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>
                <!-- Find Nearest Electric Station -->
                <div class="row">
                    <div class="col-md-12 panel panel-default">
                        <div class="panel-heading">
                            <div class="panel-title">
                                <a data-toggle="collapse" href="#collapseHydrogen">
                                    Find Nearest Electric Station
                                </a>
                            </div>
                        </div>
                        <div id="collapseHydrogen" class="panel-collapse">
                            <div class="panel-body">
                                <label for="electric_stations_for">
                                    Electric Stations For:
                                </label>
                                <select id="electric_stations_for" class="form-control">
                                    <option value=""/>
                                    {% if vehicleAgencies %}
                                        {% for item in vehicleAgencies %}
                                    <option value="{{ item.max_postal_code }}">{{ item.agency }}</option>
                                        {% endfor %}
                                    {% endif %}
                                </select>
                            </div>
                            <div class="panel-footer">
                                <button onclick="findNearestElectricButton(); return false;" class="btn btn-default" type="submit">
                                    Search
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Agency nearest Hydrogen Station -->
                <div class="row">

                    <div class="col-md-12 panel panel-default">

                            <div class="panel-heading">
                                <div class="panel-title">
                                    <a data-toggle="collapse" href="#collapseAgencyHydrogen">
                                        Closest Hydrogen Station to Agency
                                    </a>
                                </div>
                            </div>
                        <div id="collapseAgencyHydrogen" class="panel-collapse in">
                            <div class="panel-body">
                                <label for="electric_stations_for">
                                    Nearest Hydrogen Stations For:
                                </label>
                                <select id="electric_stations_for" class="form-control">
                                    <option value=""/>
                                    {% if vehicleAgencies %}
                                        {% for item in vehicleAgencies %}
                                    <option value="{{ item.max_postal_code }}">{{ item.agency }}</option>
                                        {% endfor %}
                                    {% endif %}
                                </select>
                            </div>
                            <div class="panel-footer">
                                <button onclick="agencyNearestHydrogenStation(); return false;" class="btn btn-default" type="submit">
                                    Search
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Bottom -->
        <h3>Recommend Replacement Vehicle</h3>
        <div class="row well">
            <div class="col-md-4 ">
                <form role="form">
                    <div class="form-group inline-group">

                        <label for="agency">
                            Agency
                        </label>
                        <select id="agency" class="form-control">
                            <option value=""/>
                            {% if vehicleAgencies %}
                                {% for item in vehicleAgencies %}
                            <option value="{{ item.agency }}">{{ item.agency }}</option>
                                {% endfor %}
                            {% endif %}
                        </select>
                    </div>
                    <div class="form-group inline-group">

                        <label for="total_milage">
                            Total Mileage:
                        </label>
                        <input class="form-control" id="total_milage" type="NUMBER" value="100000"/>

                    </div>
                    <div class="form-group inline-group">

                        <label for="fuel_type">
                            Fuel Type:
                        </label>
                        <select id="fuel_type" class="form-control">
                            <option value=""/>
                            {% if vehicleFuelTypes %}
                                {% for type in vehicleFuelTypes %}
                            <option value="{{ type }}">{{ type }}</option>
                                {% endfor %}
                            {% endif %}
                        </select>
                    </div>
                    <button class="btn btn-default" onclick="showRecommendations();return false;" type="submit">
                        Show Recommendations
                    </button>
                </form>
            </div>
            <!-- Table -->
            <div class="col-md-8 ">
                <table class="table table-condensed table-hover">
                    <thead>
                        <tr>
                            <th>Agency</th>
                            <th>Zip Code</th>
                            <th>Vehicle ID</th>
                        </tr>
                    </thead>
                    <tbody id="showRecTable">
                        <tr>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

<script>
    var map = L.map('map').setView([37.00, -120.00], 5);

    //Set the Basemap Layer for the feature
    L.esri.basemapLayer('Streets').addTo(map);

    //Add a feature layer to the map
    var fuelStations = L.esri.featureLayer({
        url: 'https://services.gis.ca.gov/arcgis/rest/services/Transportation/AltFuelStations/MapServer/0',
        where: 'State=\'CA\' and Fuel_Type_Code=\'HY\'',
        minZoom: 5
    }).addTo(map);

    var searchControl = L.esri.Geocoding.Controls.geosearch().addTo(map);
    var results = L.layerGroup().addTo(map);

    searchControl.on('results', function(data){
    results.clearLayers();
    for (var i = data.results.length - 1; i >= 0; i--) {
      results.addLayer(L.marker(data.results[i].latlng));
    }
  });

</script>
</body>
</html>